<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <!-- Change the title -->
    <title>This is the title!</title>
    
    <link href='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.css' rel='stylesheet' />

    <style>
    html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
    }

    #map {
        width: 100%;
        height: 100%;
    }
    </style>
</head>

<body>
  <div id="map"></div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.js'></script>
    <script>
    const overlayMaps = {};

    /*
     * Initialize Map
      Instructions:
      -Insert Access token
      -Insert style Layer
     */

    L.mapbox.accessToken = 'pk.eyJ1IjoibWF0aWtpbjkiLCJhIjoiYjMyMjBjZTE4NWUxMDkxOWZjZjFjZWEzZTcxNDUxOTkifQ._ldFl3e17jCs7aWm6zMZ3Q';
    const myMap = L.map("map").setView([34.0522, -118.2437], 9);
    L.mapbox.styleLayer('mapbox://styles/matikin9/cim5bt1q100iy9jkpl7ff9d1h').addTo(myMap); // base layer

    function getJSONData() {
      $.getJSON("sample-data.json", function(data) {
        $.each(data, function(i, val) {
          displayOnPage(val);
        });
      });
    }

    /*
     * Pull data and display on page
     */
    $(function() {
      getJSONData();
      L.control.layers(overlayMaps).addTo(myMap);
    });

    function displayOnPage(location, warningString) {
      let name = "";
      if (location.Location === "") {
        name = "anonymous";
      } else {
        name = location.Location;
      }

      const name_slug = name.replace(/\s+/g, "");
      const markers = [];

      /*
       * Add marker for each location
       * provided by participant.
       */
      const lat = location["Latitude"];
      const lng = location["Longitude"];
      const locationName = location["Location"];
      const address = location["Address"];

      if (lat == "" || lng == "") {
        warningString += `${name} has no coordinates for Location ${
          locationName
        }.<br>`;
      } else {
        const $locationInfo = $("<div>", {
          // "id": name_slug + i,
          class: "location-data " // + name_slug + "-marker"
        });

        // Build popup window
        $locationInfo.append(`<h1>${locationName}</h1>`);
        $locationInfo.append(`<h3>${address}</h3>`);

        const marker = L.marker([lat, lng])
          .on("click", onMarkerClick)
          .bindPopup($locationInfo[0])
          .addTo(myMap);

        markers.push(marker);
      }

      overlayMaps[name_slug] = L.layerGroup(markers);
    }

    function onMarkerClick(e) {
      const popup = e.target.getPopup();
      const content = popup.getContent();
      // $("#location-detail").html(content.innerHTML);
      // event.target.closePopup();
    }
    </script>
</body>

</html>
